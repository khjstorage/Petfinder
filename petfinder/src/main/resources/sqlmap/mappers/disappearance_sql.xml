<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="disappearance">

	<resultMap id="disappearanceListResultMap" type="com.petfinder.vo.DisappearanceVO">
		<id property="idx" column="D_IDX" />
		<id property="id" column="D_ID" />
		<id property="phone1" column="D_PHONE" />
		<id property="phone2" column="D_EMERTGENCY_PHONE" />
		<id property="dogname" column="D_NAME" />
		<id property="dog" column="D_DOG" />
		<id property="size" column="D_SIZE" />
		<id property="color" column="D_COLOR" />
		<id property="gender" column="D_GENDER" />
		<id property="date" column="D_DATE" />
		<id property="region" column="D_REGION" />
		<id property="title" column="D_TITLE" />
		<id property="detail" column="D_DETAIL" />
	</resultMap>

	<insert id="insertDisappearance" parameterType="disappearanceVO" useGeneratedKeys="true" keyProperty="IDX">
      <selectKey keyProperty="idx" resultType="string" order="BEFORE">
         SELECT SEQ_DISAPPEARANCE_IDX.NEXTVAL FROM DUAL
      </selectKey>
    <![CDATA[
        INSERT INTO DISAPPEARANCE(D_IDX, D_ID, D_PHONE, D_EMERTGENCY_PHONE, D_DOGNAME, D_DOG, D_SIZE, D_COLOR, D_GENDER, D_DATE, D_REGION, D_TITLE, D_DETAIL)
               VALUES(#{idx}, #{id}, #{phone1}, #{phone2}, #{dogname}, #{dog}, #{size}, #{color}, #{gender}, #{date}, #{region}, #{title}, #{detail})
       ]]>
   </insert>

	<insert id="insertDisappearanceFile" parameterType="hashmap">
       <![CDATA[
         INSERT INTO DISAPPEARANCE_FILE(D_FILE_IDX, D_BOARD_IDX, D_ORIGINAL_FILE_NAME, D_STORED_FILE_NAME, D_FILE_SIZE) 
         VALUES (SEQ_DISAPPEARANCE_FILE_IDX.NEXTVAL, #{D_BOARD_IDX}, #{D_ORIGINAL_FILE_NAME}, #{D_STORED_FILE_NAME}, #{D_FILE_SIZE})
       ]]>
	</insert>
		
	<select id="disappearanceList" parameterType="disappearanceVO" resultMap="disappearanceListResultMap">
		<![CDATA[
		SELECT * FROM DISAPPEARANCE ORDER BY D_IDX DESC
		]]>
	</select>
	
	<select id="selectBoardDetail" parameterType="String" resultType="hashmap">
    <![CDATA[
        SELECT * FROM DISAPPEARANCE WHERE D_IDX = #{idx}        
    ]]>
	</select>
	
	
	<select id="deleteDisappearance" parameterType="String">
    <![CDATA[
        DELETE FROM DISAPPEARANCE WHERE D_IDX = #{idx}
    ]]>
	</select>
	
	<select id="deleteDisappearanceFile" parameterType="String">
    <![CDATA[
        DELETE FROM DISAPPEARANCE_FILE WHERE D_BOARD_IDX = #{idx}
    ]]>
	</select>
	
	<update id="updateDisappearance" parameterType="disappearanceVO" >
	<![CDATA[
	    UPDATE DISAPPEARANCE
		SET D_ID = #{id}, 
			D_PHONE = #{phone1}, 
			D_EMERTGENCY_PHONE = #{phone2}, 
			D_DOGNAME = #{dogname}, 
			D_DOG = #{dog}, 
			D_SIZE = #{size}, 
			D_COLOR = #{color}, 
			D_GENDER = #{gender},  
			D_DATE = #{date}, 
			D_REGION = #{region}, 
			D_TITLE = #{title}, 
			D_DETAIL = #{detail}
		WHERE D_IDX = #{idx}
	]]>
	</update>
	
	<update id="updateDisappearanceFile" parameterType="hashmap" >
		<![CDATA[
	    UPDATE DISAPPEARANCE_FILE
		SET D_ORIGINAL_FILE_NAME = #{D_ORIGINAL_FILE_NAME},
			D_STORED_FILE_NAME = #{D_STORED_FILE_NAME}, 
			D_FILE_SIZE = #{D_FILE_SIZE}
		WHERE D_BOARD_IDX = CAST(#{D_BOARD_IDX} as INTEGER)
		]]>
	</update>
	
</mapper>

